name: Dependabot Auto-merge

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º—ë—Ä–∂ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç Dependabot –¥–ª—è patch –∏ minor –≤–µ—Ä—Å–∏–π
# Major –≤–µ—Ä—Å–∏–∏ —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–≥–æ —Ä–µ–≤—å—é

on:
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-merge:
    name: Auto-merge Dependabot PRs
    runs-on: ubuntu-latest
    
    # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è PR –æ—Ç Dependabot
    if: github.actor == 'dependabot[bot]'
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v6

      - name: ü§ñ Dependabot metadata
        id: metadata
        uses: dependabot/fetch-metadata@v2
        with:
          github-token: "${{ secrets.GITHUB_TOKEN }}"

      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–¥–æ–±—Ä—è–µ–º –∏ –º–µ—Ä–∂–∏–º patch –∏ minor –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
      - name: ‚úÖ Auto-approve and merge
        if: |
          steps.metadata.outputs.update-type == 'version-update:semver-patch' ||
          steps.metadata.outputs.update-type == 'version-update:semver-minor'
        run: |
          gh pr review --approve "${{ github.event.pull_request.html_url }}"
          gh pr merge --auto --squash "${{ github.event.pull_request.html_url }}"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # –î–ª—è major –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º
      - name: üí¨ Comment on major updates
        if: steps.metadata.outputs.update-type == 'version-update:semver-major'
        run: |
          gh pr comment "${{ github.event.pull_request.html_url }}" --body "‚ö†Ô∏è –≠—Ç–æ **major** –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –º–µ—Ä–∂–µ–º."
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
